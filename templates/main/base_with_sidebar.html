{% extends 'base.html' %}

{% block content %}
<div class="flex h-screen bg-gray-100">
    <!-- Sidebar Toggle Button (when sidebar is closed) -->
    <div id="sidebar-toggle-closed" class="fixed top-4 left-4 z-50 hidden">
        <button onclick="toggleSidebar()" class="bg-blue-600 text-white p-2 rounded-lg shadow-lg hover:bg-blue-700 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="w-64 bg-white shadow-lg flex flex-col min-h-0 transition-all duration-300 ease-in-out transform translate-x-0">
        <!-- Header with Toggle Button -->
        <div class="flex items-center justify-between h-16 bg-blue-600 flex-shrink-0 px-4">
            <h1 class="text-white text-xl font-bold">StudPro</h1>
            <button onclick="toggleSidebar()" class="text-white hover:text-gray-200 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Scrollable Navigation -->
        <nav class="flex-1 overflow-y-auto min-h-0">
            <div class="px-4 py-2 flex-shrink-0">
                <p class="text-gray-600 text-sm font-semibold">Welcome, {{ user.first_name }}!</p>
            </div>
            
            <!-- Main Navigation Section -->
            <div class="px-4 py-2">
                <button onclick="toggleSection('main-nav')" class="flex items-center justify-between w-full text-left text-sm font-semibold text-gray-700 hover:text-gray-900 focus:outline-none">
                    <span>Main Navigation</span>
                    <svg id="main-nav-icon" class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div id="main-nav" class="mt-2 space-y-1">
                    <a href="{% url 'home' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'home' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-home mr-3"></i>
                        Home
                    </a>
                    
                    <a href="{% url 'profile' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'profile' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-user mr-3"></i>
                        Profile
                    </a>
                    
                    <a href="{% url 'learning_track' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'learning_track' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-graduation-cap mr-3"></i>
                        Learning Track
                    </a>
                    
                    <a href="{% url 'chatbot' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'chatbot' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-robot mr-3"></i>
                        Chatbot
                    </a>
                    
                    <a href="{% url 'files' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'files' %}bg-blue-50 text-blue-600{% endif %}">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Files
                    </a>
                </div>
            </div>
            
            <!-- Groups Section -->
            <div class="px-4 py-2">
                <button onclick="toggleSection('groups-nav')" class="flex items-center justify-between w-full text-left text-sm font-semibold text-gray-700 hover:text-gray-900 focus:outline-none">
                    <span>Groups</span>
                    <svg id="groups-nav-icon" class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div id="groups-nav" class="mt-2 space-y-1">
                    <a href="{% url 'groups' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'groups' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-users mr-3"></i>
                        Create Groups
                    </a>
                    
                    <a href="{% url 'my_groups' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'my_groups' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-user-friends mr-3"></i>
                        My Groups
                    </a>
                    
                    <a href="{% url 'explore_groups' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'explore_groups' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-search mr-3"></i>
                        Explore Groups
                    </a>
                    
                    <a href="{% url 'my_join_requests' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'my_join_requests' %}bg-blue-50 text-blue-600{% endif %}">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                        </svg>
                        My Join Requests
                    </a>
                </div>
            </div>
            
            <!-- Networking Section -->
            <div class="px-4 py-2">
                <button onclick="toggleSection('networking-nav')" class="flex items-center justify-between w-full text-left text-sm font-semibold text-gray-700 hover:text-gray-900 focus:outline-none">
                    <span>Networking</span>
                    <svg id="networking-nav-icon" class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div id="networking-nav" class="mt-2 space-y-1">
                    <a href="{% url 'networking' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'networking' %}bg-blue-50 text-blue-600{% endif %}">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        Discover People
                    </a>
                    
                    <a href="{% url 'connections' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'connections' %}bg-blue-50 text-blue-600{% endif %}">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                        </svg>
                        Connections
                    </a>
                    
                    <a href="{% url 'messages_list' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'messages_list' %}bg-blue-50 text-blue-600{% endif %}">
                        <div class="relative">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                            {% if unread_messages_count > 0 %}
                            <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold animate-pulse">
                                {{ unread_messages_count }}
                            </span>
                            {% endif %}
                        </div>
                        Messages
                    </a>
                    
                    <a href="{% url 'video_calls' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'video_calls' %}bg-blue-50 text-blue-600{% endif %}">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        Video Calls
                    </a>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div class="px-4 py-2">
                <button onclick="toggleSection('settings-nav')" class="flex items-center justify-between w-full text-left text-sm font-semibold text-gray-700 hover:text-gray-900 focus:outline-none">
                    <span>Settings</span>
                    <svg id="settings-nav-icon" class="w-4 h-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div id="settings-nav" class="mt-2 space-y-1">
                    <a href="{% url 'settings' %}" class="flex items-center px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors {% if request.resolver_match.url_name == 'settings' %}bg-blue-50 text-blue-600{% endif %}">
                        <i class="fas fa-cog mr-3"></i>
                        Settings
                    </a>
                    
                    <a href="{% url 'signout' %}" class="flex items-center px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt mr-3"></i>
                        Sign Out
                    </a>
                </div>
            </div>
        </nav>
    </div>
    
    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden min-h-0 transition-all duration-300 ease-in-out">
        <!-- Top bar -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between px-6 py-4">
                <h2 class="text-xl font-semibold text-gray-800">{% block page_title %}Dashboard{% endblock %}</h2>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-600">{{ user.username }}</span>
                    <img class="h-8 w-8 rounded-full bg-gray-300" src="https://via.placeholder.com/32" alt="Profile">
                </div>
            </div>
        </header>
        
        <!-- Messages -->
        {% if messages %}
            <div class="px-6 py-4">
                {% for message in messages %}
                    <div class="alert-message bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <!-- Page Content -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6 min-h-0">
            {% block main_content %}
            {% endblock %}
        </main>
    </div>
</div>

<script>
// Sidebar toggle functionality
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const toggleClosed = document.getElementById('sidebar-toggle-closed');
    const isOpen = !sidebar.classList.contains('-translate-x-full');
    
    if (isOpen) {
        // Close sidebar
        sidebar.classList.add('-translate-x-full');
        toggleClosed.classList.remove('hidden');
        // Store state in localStorage
        localStorage.setItem('sidebarOpen', 'false');
    } else {
        // Open sidebar
        sidebar.classList.remove('-translate-x-full');
        toggleClosed.classList.add('hidden');
        // Store state in localStorage
        localStorage.setItem('sidebarOpen', 'true');
    }
}

// Expand/collapse functionality for sections
function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const icon = document.getElementById(sectionId + '-icon');
    if (!section || !icon) return;
    
    if (section.style.display === 'none' || section.classList.contains('hidden')) {
        section.style.display = 'block';
        section.classList.remove('hidden');
        icon.style.transform = 'rotate(0deg)';
    } else {
        section.style.display = 'none';
        section.classList.add('hidden');
        icon.style.transform = 'rotate(-90deg)';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Initialize section toggles
    const sections = ['main-nav', 'groups-nav', 'networking-nav', 'settings-nav'];
    sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        const icon = document.getElementById(sectionId + '-icon');
        if (section && icon) {
            section.style.display = 'block';
            section.classList.remove('hidden');
            icon.style.transform = 'rotate(0deg)';
        }
    });
    
    // Restore sidebar state from localStorage
    const sidebarOpen = localStorage.getItem('sidebarOpen');
    if (sidebarOpen === 'false') {
        const sidebar = document.getElementById('sidebar');
        const toggleClosed = document.getElementById('sidebar-toggle-closed');
        sidebar.classList.add('-translate-x-full');
        toggleClosed.classList.remove('hidden');
    }
});

// Close sidebar on mobile when clicking outside
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const toggleClosed = document.getElementById('sidebar-toggle-closed');
    
    // If sidebar is open and click is outside sidebar and not on toggle button
    if (!sidebar.classList.contains('-translate-x-full') && 
        !sidebar.contains(event.target) && 
        !toggleClosed.contains(event.target)) {
        
        // Only close on mobile (screen width < 768px)
        if (window.innerWidth < 768) {
            sidebar.classList.add('-translate-x-full');
            toggleClosed.classList.remove('hidden');
            localStorage.setItem('sidebarOpen', 'false');
        }
    }
});
</script>
{% endblock %}
